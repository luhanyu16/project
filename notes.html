<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>便條紙</title>
    <style>
        .note {
            width: 300px;
            height: 300px;
            background-color: #FFFBCC;
            padding: 10px;
            margin: 10px;
            border: 1px solid #CCC;
            display: inline-block;
            position: relative;
            resize: both;
            overflow: auto;
        }
        .canvas-container {
            border: 1px solid #333;
            width: 100%;
            height: 100%;
        }
        canvas {
            width: 100%;
            height: 100%;
            background-color: white;
        }
        .canvas-tools {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div id="note-container"></div>
    <button id="add-note-btn">新增便條紙</button>

    <script>
        const noteContainer = document.getElementById("note-container");
        const addNoteBtn = document.getElementById("add-note-btn");

        addNoteBtn.addEventListener("click", createNoteElement);

        function createNoteElement() {
            const id = Date.now();
            const note = document.createElement("div");
            note.classList.add("note");

            note.innerHTML = `
                <div class="canvas-tools">
                    <button id="upload-${id}">上傳圖片</button>
                    <button id="zoom-in-${id}">放大</button>
                    <button id="zoom-out-${id}">縮小</button>
                </div>
                <div class="canvas-container">
                    <canvas id="canvas-${id}"></canvas>
                </div>
                <input type="file" id="image-input-${id}" style="display: none;">
            `;

            noteContainer.appendChild(note);

            const canvas = document.getElementById(`canvas-${id}`);
            const ctx = canvas.getContext("2d");
            canvas.width = 300;
            canvas.height = 300;

            let scale = 1.0;
            const zoomInButton = document.getElementById(`zoom-in-${id}`);
            const zoomOutButton = document.getElementById(`zoom-out-${id}`);
            const uploadButton = document.getElementById(`upload-${id}`);
            const imageInput = document.getElementById(`image-input-${id}`);

            // 繪畫功能
            let isDrawing = false;
            let startX = 0;
            let startY = 0;

            canvas.addEventListener("mousedown", (e) => {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                startX = (e.clientX - rect.left) / scale;
                startY = (e.clientY - rect.top) / scale;
            });

            canvas.addEventListener("mousemove", (e) => {
                if (isDrawing) {
                    const rect = canvas.getBoundingClientRect();
                    const x = (e.clientX - rect.left) / scale;
                    const y = (e.clientY - rect.top) / scale;
                    ctx.beginPath();
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                    startX = x;
                    startY = y;
                }
            });

            canvas.addEventListener("mouseup", () => isDrawing = false);
            canvas.addEventListener("mouseout", () => isDrawing = false);

            // 放大和縮小功能
            function applyZoom() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.save();
                ctx.scale(scale, scale);
                ctx.drawImage(image, 0, 0);
                ctx.restore();
            }

            zoomInButton.addEventListener("click", () => {
                scale = Math.min(scale + 0.1, 3); // 最大放大3倍
                applyZoom();
            });

            zoomOutButton.addEventListener("click", () => {
                scale = Math.max(scale - 0.1, 0.5); // 最小縮小到0.5倍
                applyZoom();
            });

            // 上傳圖片功能
            let image = new Image();
            uploadButton.addEventListener("click", () => imageInput.click());
            imageInput.addEventListener("change", (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        image.onload = () => {
                            applyZoom();
                        };
                        image.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    </script>
</body>
</html>
